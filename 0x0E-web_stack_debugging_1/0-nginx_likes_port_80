#!/usr/bin/env bash
# This script configures Nginx to listen on port 80 for all active IPv4 IPs

# Install Nginx if not already installed
if ! command -v nginx &> /dev/null; then
    apt-get update
    apt-get install -y nginx
fi

# Start Nginx service if not running
if ! systemctl is-active --quiet nginx; then
    systemctl start nginx
fi

# Configure Nginx to listen on port 80 for all IPv4 addresses
sed -i 's/listen\s\+[0-9]\+\.[0-9]\+\.[0-9]\+\.[0-9]\+\:[0-9]\+/listen 0.0.0.0:80/g' /etc/nginx/nginx.conf
sed -i 's/listen\s\+[0-9]\+\.[0-9]\+\.[0-9]\+\.[0-9]\+\:[0-9]\+/listen 0.0.0.0:80/g' /etc/nginx/conf.d/*.conf

# Restart Nginx to apply the configuration changes
systemctl restart nginx

# Allow Nginx through the firewall (Ubuntu)
ufw allow 'Nginx HTTP'
